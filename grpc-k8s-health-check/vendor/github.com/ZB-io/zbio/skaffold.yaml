apiVersion: skaffold/v1
kind: Config
metadata:
  name: zbio
build:
  local: {}
  tagPolicy:
    envTemplate:
      template: "{{.IMAGE_NAME}}:{{.ZBIO_IMAGE_TAG}}"
  artifacts:
  # To build specific binary {broker, service, client, cli}, `make` should accept parameter to build specific binary instead of all at once.
  - image: zbio/zbsvc
    custom:
      buildCommand: make build-linux -C service && make image -C service
      dependencies:
        paths:
        - service/
  - image: zbio/zbbroker
    custom:
      buildCommand: make build-linux -C broker && make image -C broker
      dependencies:
        paths:
        - broker/
  - image: zbio-cli
    custom:
      buildCommand: make build-linux -C scratchpad/zbio && make build-linux -C client && make image -C scratchpad/zbio
      dependencies:
        paths:
        - scratchpad/zbio/
        - broker/
        - service/
        - client/
deploy:
  kubectl:
    manifests:
    - kubernetes-manifests/zbio.yaml 
    - kubernetes-manifests/cli.yaml
